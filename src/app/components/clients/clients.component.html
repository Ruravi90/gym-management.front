<header class="main-header">
    <div class="header-info">
        <h1 class="page-title">Administraci√≥n de Clientes</h1>
        <p class="page-subtitle">Gestiona tu comunidad de guerreros en tiempo real</p>
    </div>
    <div class="header-actions">
        <button class="app-btn app-btn-primary" (click)="openRegisterModal()">
            <span>+</span> Nuevo Socio
        </button>
    </div>
</header>

<div class="dashboard-actions">
    <div class="search-bar">
        <span class="search-icon">üîç</span>
        <input type="text" class="app-input" placeholder="Buscar socios por nombre o email..." (input)="onSearch($event)">
    </div>
</div>

<!-- Table View for Desktop -->
<div class="table-responsive-wrapper desktop-view">
    <table class="app-table">
        <thead>
            <tr>
                <th>ID</th>
                <th>Informaci√≥n del Socio</th>
                <th>Plan / Membres√≠a</th>
                <th>Estado</th>
                <th class="text-right">Centro de Acci√≥n</th>
            </tr>
        </thead>
        <tbody>
            <tr *ngFor="let client of filteredClients" class="client-row">
                <td class="id-cell">#{{client.id}}</td>
                <td>
                    <div class="client-info">
                        <span class="client-name">{{client.name}}</span>
                        <span class="client-email">{{client.email}}</span>
                    </div>
                </td>
                <td>
                    <span class="membership-badge" [attr.data-type]="getClientMembershipType(client)">
                        {{getClientMembershipType(client) | uppercase}}
                    </span>
                </td>
                <td>
                    <div class="status-badge" [class.active]="client.status">
                        {{client.status ? 'ACTIVO' : 'INACTIVO'}}
                    </div>
                </td>
                <td class="text-right">
                    <div class="action-buttons">
                        <button class="btn-action-icon edit" (click)="openEditModal(client)" title="Editar">‚úèÔ∏è</button>
                        <button class="btn-action-icon delete" (click)="confirmDelete(client)" title="Eliminar">üóëÔ∏è</button>
                        <button class="app-btn app-btn-secondary btn-sm" (click)="openFaceScanModal(client)">
                            üì∑ Rostro
                        </button>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>

<!-- Card View for Mobile -->
<div class="cards-container mobile-view" *ngIf="paginatedClients.length > 0">
    <div class="client-card" *ngFor="let client of paginatedClients">
        <div class="card-header">
            <div class="header-top">
                <div class="client-id">#{{client.id}}</div>
                <div class="client-name">{{client.name}}</div>
            </div>
            <div class="header-tags">
                <span class="membership-badge" [attr.data-type]="getClientMembershipType(client)">
                    {{getClientMembershipType(client) | uppercase}}
                </span>
                <div class="status-badge" [class.active]="client.status">
                    {{client.status ? 'ACTIVO' : 'INACTIVO'}}
                </div>
            </div>
        </div>

        <div class="card-body">
            <div class="client-details">
                <div class="detail-item">
                    <span class="detail-label">Email:</span>
                    <span class="detail-value">{{client.email}}</span>
                </div>
                <div class="detail-item">
                    <span class="detail-label">Tel√©fono:</span>
                    <span class="detail-value">{{client.phone || 'N/A'}}</span>
                </div>
            </div>
        </div>

        <div class="card-actions">
            <button class="app-btn app-btn-secondary btn-sm" (click)="openEditModal(client)">Editar</button>
            <button class="app-btn app-btn-danger btn-sm" (click)="confirmDelete(client)">Eliminar</button>
            <button class="app-btn app-btn-primary btn-sm" (click)="openFaceScanModal(client)">üì∑ Rostro</button>
        </div>
    </div>
</div>

<!-- Empty state for mobile -->
<div class="empty-state mobile-view" *ngIf="paginatedClients.length === 0 && filteredClients.length > 0">
    <p>No se encontraron clientes en esta p√°gina</p>
</div>

<div class="empty-state mobile-view" *ngIf="filteredClients.length === 0">
    <p>No se encontraron clientes</p>
</div>

<!-- Pagination Controls for Mobile -->
<div class="pagination-controls mobile-view" *ngIf="totalPages > 1">
    <div class="pagination-info">
        P√°gina {{currentPage}} de {{totalPages}}
    </div>
    <div class="pagination-buttons">
        <button class="app-btn app-btn-secondary btn-sm"
                [disabled]="currentPage === 1"
                (click)="prevPage()">
            Anterior
        </button>
        <span class="page-numbers">
            <button *ngFor="let page of getPageNumbers()"
                    class="app-btn btn-sm"
                    [class.app-btn-primary]="page === currentPage"
                    [class.app-btn-secondary]="page !== currentPage"
                    (click)="goToPage(page)">
                {{page}}
            </button>
        </span>
        <button class="app-btn app-btn-secondary btn-sm"
                [disabled]="currentPage === totalPages"
                (click)="nextPage()">
            Siguiente
        </button>
    </div>
</div>

<!-- Unified Modal: Registro / Edici√≥n -->
<div class="modal-backdrop" *ngIf="showClientModal">
    <div class="app-card modal-card">
        <div class="modal-header">
            <h3>{{editingClient ? 'Modificar Guerrero' : 'Registro de Nuevo Socio'}}</h3>
            <button class="btn-close" (click)="closeClientModal()">&times;</button>
        </div>
        <div class="modal-body">
            <form (ngSubmit)="saveClient()" class="compact-form">
                <div class="form-grid">
                    <div class="form-group">
                        <label>Nombre Completo</label>
                        <input type="text" [(ngModel)]="clientForm.name" name="name" class="app-input" required>
                    </div>
                    <div class="form-group">
                        <label>Correo Electr√≥nico</label>
                        <input type="email" [(ngModel)]="clientForm.email" name="email" class="app-input" required>
                    </div>
                </div>
                <!-- Password removed for clients (not required) -->
                <div class="form-grid">
                    <div class="form-group">
                        <label>Tel√©fono</label>
                        <input type="text" [(ngModel)]="clientForm.phone" name="phone" class="app-input">
                    </div>
                    <div class="form-group">
                        <label>Estado de Cuenta</label>
                        <select [(ngModel)]="clientForm.status" name="status" class="app-input">
                            <option [ngValue]="true">Activo</option>
                            <option [ngValue]="false">Inactivo</option>
                        </select>
                    </div>
                </div>
                <div class="modal-actions">
                    <button type="button" class="app-btn app-btn-secondary" (click)="closeClientModal()">Cancelar</button>
                    <button type="submit" class="app-btn app-btn-primary">{{editingClient ? 'Actualizar' : 'Registrar'}}</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Face Scan Modal -->
<div class="modal-backdrop" *ngIf="showFaceScanModal">
    <div class="app-card modal-card tech-modal">
        <div class="modal-header">
            <h3>Identidad Biom√©trica: {{scanningClient?.name}}</h3>
            <button class="btn-close" (click)="closeFaceScanModal()">&times;</button>
        </div>
        <div class="modal-body centered">
            <div class="viewfinder-wrapper">
                <video #video class="video-preview" autoplay playsinline [class.hidden]="!streaming"></video>

                <!-- Visual Guidance Overlay -->
                <div class="face-guide-overlay">
                    <div class="face-guide-oval"></div>
                    <div class="face-guide-label">Centra el rostro aqu√≠</div>
                </div>

                <div class="scan-bar"></div>

                <!-- Camera toggle button -->
                <div class="camera-toggle-button" *ngIf="streaming">
                    <button (click)="toggleCamera()" class="app-btn app-btn-tertiary" title="Cambiar c√°mara">
                        üîÑ C√ÅMARA
                    </button>
                </div>
            </div>
            <p class="hint" *ngIf="!registrationMessage">Aseg√∫rate de que el rostro encaje en la gu√≠a y est√© bien iluminado.</p>

            <!-- Dynamic Status Message -->
            <div class="registration-status" *ngIf="registrationMessage" [class.success]="registrationSuccess" [class.error]="!registrationSuccess && !isRegistering">
                <span class="status-icon">{{ registrationSuccess ? '‚úÖ' : isRegistering ? '‚åõ' : '‚ö†Ô∏è' }}</span>
                {{ registrationMessage }}
            </div>

            <button class="app-btn app-btn-primary" (click)="captureFace()" [disabled]="isRegistering || registrationSuccess">
                {{ isRegistering ? 'Procesando...' : registrationSuccess ? 'Completado' : 'Capturar e Identificar' }}
            </button>
        </div>
    </div>
</div>

<!-- Delete Confirmation Modal -->
<div class="modal-backdrop" *ngIf="showDeleteConfirm">
    <div class="app-card modal-card alert-modal">
        <div class="modal-body centered">
            <span class="alert-icon">‚ö†Ô∏è</span>
            <h3>¬øEliminar Guerrero?</h3>
            <p>¬øEst√°s seguro de que deseas eliminar permanentemente a <strong class="highlight">{{deletingClient?.name}}</strong>?</p>
            <div class="modal-actions centered">
                <button class="app-btn app-btn-secondary" (click)="closeDeleteConfirmation()">Conservar</button>
                <button class="app-btn app-btn-danger" (click)="deleteClient()">S√≠, Eliminar</button>
            </div>
        </div>
    </div>
</div>
