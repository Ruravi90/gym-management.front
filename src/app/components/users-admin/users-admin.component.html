<header class="main-header">
    <div class="header-info">
        <h1 class="page-title">Administraci√≥n de Usuarios</h1>
        <p class="page-subtitle">Gestiona los usuarios del sistema</p>
    </div>
    <div class="header-actions" *ngIf="canCreateUsers()">
        <button class="app-btn app-btn-primary" (click)="openRegisterModal()">
            <span>+</span> Nuevo Usuario
        </button>
    </div>
</header>

<div class="dashboard-actions">
    <div class="search-bar">
        <span class="search-icon">üîç</span>
        <input type="text" class="app-input" placeholder="Buscar usuarios por nombre o email..." (input)="onSearch($event)">
    </div>
</div>

<div *ngIf="loading">Cargando...</div>
<div *ngIf="error" class="error-container">
    <div class="error-icon">‚ö†Ô∏è</div>
    <div class="error-content">
        <h3>No se pudieron cargar los usuarios</h3>
        <p>
            Por favor, verifica tu conexi√≥n a internet o intenta nuevamente m√°s
            tarde.
        </p>
    </div>
    <button (click)="loadUsers()" class="retry-btn">Reintentar</button>
</div>

<!-- Table View for Desktop -->
<div class="table-responsive-wrapper desktop-view">
    <table class="app-table">
        <thead>
            <tr>
                <th>ID</th>
                <th>Informaci√≥n del Usuario</th>
                <th>Rol</th>
                <th>Estado</th>
                <th class="text-right">Centro de Acci√≥n</th>
            </tr>
        </thead>
        <tbody>
            <tr *ngFor="let user of filteredUsers" class="user-row">
                <td class="id-cell">#{{user.id}}</td>
                <td class="user-info-cell">
                    <div class="user-info">
                        <span class="user-name">{{user.name}}</span>
                        <span class="user-email">{{user.email}}</span>
                    </div>
                </td>
                <td class="role-cell">
                    <span class="role-badge" [attr.data-type]="user.role">
                        {{getRoleLabel(user.role) | uppercase}}
                    </span>
                </td>
                <td class="status-cell">
                    <div class="status-badge" [class.active]="user.status">
                        {{user.status ? 'ACTIVO' : 'INACTIVO'}}
                    </div>
                </td>
                <td class="actions-cell text-right">
                    <div class="action-buttons" *ngIf="canManageUser(user)">
                        <button class="btn-action-icon edit" (click)="openEditModal(user)" title="Editar">‚úèÔ∏è</button>
                        <button class="btn-action-icon delete" (click)="confirmDelete(user)" title="Eliminar">üóëÔ∏è</button>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>

<!-- Card View for Mobile -->
<div class="cards-container mobile-view" *ngIf="paginatedUsers.length > 0">
    <div class="user-card" *ngFor="let user of paginatedUsers">
        <div class="card-header">
            <div class="header-top">
                <div class="user-id">#{{user.id}}</div>
                <div class="user-name">{{user.name}}</div>
            </div>
            <div class="header-tags">
                <span class="role-badge" [attr.data-type]="user.role">
                    {{getRoleLabel(user.role) | uppercase}}
                </span>
                <div class="status-badge" [class.active]="user.status">
                    {{user.status ? 'ACTIVO' : 'INACTIVO'}}
                </div>
            </div>
        </div>

        <div class="card-body">
            <div class="user-details">
                <div class="detail-item">
                    <span class="detail-label">Email:</span>
                    <span class="detail-value">{{user.email}}</span>
                </div>
            </div>
        </div>

        <div class="card-actions" *ngIf="canManageUser(user)">
            <button class="app-btn app-btn-secondary btn-sm" (click)="openEditModal(user)">Editar</button>
            <button class="app-btn app-btn-danger btn-sm" (click)="confirmDelete(user)">Eliminar</button>
        </div>
    </div>
</div>

<!-- Empty state for mobile -->
<div class="empty-state mobile-view" *ngIf="paginatedUsers.length === 0 && filteredUsers.length > 0">
    <p>No se encontraron usuarios en esta p√°gina</p>
</div>

<div class="empty-state mobile-view" *ngIf="filteredUsers.length === 0">
    <p>No se encontraron usuarios</p>
</div>

<!-- Pagination Controls for Mobile -->
<div class="pagination-controls mobile-view" *ngIf="totalPages > 1">
    <div class="pagination-info">
        P√°gina {{currentPage}} de {{totalPages}}
    </div>
    <div class="pagination-buttons">
        <button class="app-btn app-btn-secondary btn-sm"
                [disabled]="currentPage === 1"
                (click)="prevPage()">
            Anterior
        </button>
        <span class="page-numbers">
            <button *ngFor="let page of getPageNumbers()"
                    class="app-btn btn-sm"
                    [class.app-btn-primary]="page === currentPage"
                    [class.app-btn-secondary]="page !== currentPage"
                    (click)="goToPage(page)">
                {{page}}
            </button>
        </span>
        <button class="app-btn app-btn-secondary btn-sm"
                [disabled]="currentPage === totalPages"
                (click)="nextPage()">
            Siguiente
        </button>
    </div>
</div>

<!-- Unified Modal: Registro / Edici√≥n -->
<div class="modal-backdrop" *ngIf="showUserModal">
    <div class="app-card modal-card">
        <div class="modal-header">
            <h3>{{editingUser ? 'Modificar Usuario' : 'Registro de Nuevo Usuario'}}</h3>
            <button class="btn-close" (click)="closeUserModal()">&times;</button>
        </div>
        <div class="modal-body">
            <form (ngSubmit)="saveUser()" class="compact-form">
                <div class="form-grid">
                    <div class="form-group">
                        <label>Nombre Completo</label>
                        <input type="text" [(ngModel)]="userForm.name" name="name" class="app-input" required>
                    </div>
                    <div class="form-group">
                        <label>Correo Electr√≥nico</label>
                        <input type="email" [(ngModel)]="userForm.email" name="email" class="app-input" required>
                    </div>
                </div>
                <div class="form-grid" *ngIf="!editingUser">
                    <div class="form-group">
                        <label>Contrase√±a</label>
                        <input type="password" [(ngModel)]="userForm.password" name="password" class="app-input" required>
                    </div>
                    <div class="form-group">
                        <label>Rol</label>
                        <select [(ngModel)]="userForm.role" name="role" class="app-input">
                            <option *ngFor="let r of getFilteredRoles()" [value]="r.value">{{ r.label }}</option>
                        </select>
                    </div>
                </div>
                <div class="form-grid" *ngIf="editingUser">
                    <div class="form-group">
                        <label>Rol</label>
                        <select [(ngModel)]="userForm.role" name="role" class="app-input">
                            <option *ngFor="let r of getFilteredRoles()" [value]="r.value">{{ r.label }}</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Estado de Cuenta</label>
                        <select [(ngModel)]="userForm.status" name="status" class="app-input">
                            <option [ngValue]="true">Activo</option>
                            <option [ngValue]="false">Inactivo</option>
                        </select>
                    </div>
                </div>
                <div class="modal-actions">
                    <button type="button" class="app-btn app-btn-secondary" (click)="closeUserModal()">Cancelar</button>
                    <button type="submit" class="app-btn app-btn-primary">{{editingUser ? 'Actualizar' : 'Registrar'}}</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Delete Confirmation Modal -->
<div class="modal-backdrop" *ngIf="showDeleteConfirm">
    <div class="app-card modal-card alert-modal">
        <div class="modal-body centered">
            <span class="alert-icon">‚ö†Ô∏è</span>
            <h3>¬øEliminar Usuario?</h3>
            <p>¬øEst√°s seguro de que deseas eliminar permanentemente a <strong class="highlight">{{deletingUser?.name}}</strong>?</p>
            <div class="modal-actions centered">
                <button class="app-btn app-btn-secondary" (click)="closeDeleteConfirmation()">Conservar</button>
                <button class="app-btn app-btn-danger" (click)="deleteUser(deletingUser?.id)">S√≠, Eliminar</button>
            </div>
        </div>
    </div>
</div>
