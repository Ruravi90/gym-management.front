<header class="main-header">
    <div class="header-info">
        <h1 class="page-title">Administraci√≥n de Usuarios</h1>
        <p class="page-subtitle">Gestiona los usuarios del sistema</p>
    </div>
    <div class="header-actions">
        <button class="app-btn app-btn-primary" (click)="openRegisterModal()">
            <span>+</span> Nuevo Usuario
        </button>
    </div>
</header>

<div class="dashboard-actions">
    <div class="search-bar">
        <span class="search-icon">üîç</span>
        <input type="text" class="app-input" placeholder="Buscar usuarios por nombre o email..." (input)="onSearch($event)">
    </div>
</div>

<div *ngIf="loading">Cargando...</div>
<div *ngIf="error" class="error-container">
    <div class="error-icon">‚ö†Ô∏è</div>
    <div class="error-content">
        <h3>No se pudieron cargar los usuarios</h3>
        <p>
            Por favor, verifica tu conexi√≥n a internet o intenta nuevamente m√°s
            tarde.
        </p>
    </div>
    <button (click)="loadUsers()" class="retry-btn">Reintentar</button>
</div>

<div class="table-responsive-wrapper">
    <table class="app-table">
        <thead>
            <tr>
                <th>ID</th>
                <th>Informaci√≥n del Usuario</th>
                <th>Rol</th>
                <th>Estado</th>
                <th class="text-right">Centro de Acci√≥n</th>
            </tr>
        </thead>
        <tbody>
            <tr *ngFor="let user of filteredUsers" class="user-row">
                <td class="id-cell">#{{user.id}}</td>
                <td>
                    <div class="user-info">
                        <span class="user-name">{{user.name}}</span>
                        <span class="user-email">{{user.email}}</span>
                    </div>
                </td>
                <td>
                    <span class="role-badge" [attr.data-type]="user.role">
                        {{getRoleLabel(user.role) | uppercase}}
                    </span>
                </td>
                <td>
                    <div class="status-badge" [class.active]="user.status">
                        {{user.status ? 'ACTIVO' : 'INACTIVO'}}
                    </div>
                </td>
                <td class="text-right">
                    <div class="action-buttons">
                        <button class="btn-action-icon edit" (click)="openEditModal(user)" title="Editar">‚úèÔ∏è</button>
                        <button class="btn-action-icon delete" (click)="confirmDelete(user)" title="Eliminar">üóëÔ∏è</button>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>

<!-- Unified Modal: Registro / Edici√≥n -->
<div class="modal-backdrop" *ngIf="showUserModal">
    <div class="app-card modal-card">
        <div class="modal-header">
            <h3>{{editingUser ? 'Modificar Usuario' : 'Registro de Nuevo Usuario'}}</h3>
            <button class="btn-close" (click)="closeUserModal()">&times;</button>
        </div>
        <div class="modal-body">
            <form (ngSubmit)="saveUser()" class="compact-form">
                <div class="form-grid">
                    <div class="form-group">
                        <label>Nombre Completo</label>
                        <input type="text" [(ngModel)]="userForm.name" name="name" class="app-input" required>
                    </div>
                    <div class="form-group">
                        <label>Correo Electr√≥nico</label>
                        <input type="email" [(ngModel)]="userForm.email" name="email" class="app-input" required>
                    </div>
                </div>
                <div class="form-grid" *ngIf="!editingUser">
                    <div class="form-group">
                        <label>Contrase√±a</label>
                        <input type="password" [(ngModel)]="userForm.password" name="password" class="app-input" required>
                    </div>
                    <div class="form-group">
                        <label>Rol</label>
                        <select [(ngModel)]="userForm.role" name="role" class="app-input">
                            <option *ngFor="let r of roles" [value]="r.value">{{ r.label }}</option>
                        </select>
                    </div>
                </div>
                <div class="form-grid" *ngIf="editingUser">
                    <div class="form-group">
                        <label>Rol</label>
                        <select [(ngModel)]="userForm.role" name="role" class="app-input">
                            <option *ngFor="let r of roles" [value]="r.value">{{ r.label }}</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Estado de Cuenta</label>
                        <select [(ngModel)]="userForm.status" name="status" class="app-input">
                            <option [ngValue]="true">Activo</option>
                            <option [ngValue]="false">Inactivo</option>
                        </select>
                    </div>
                </div>
                <div class="modal-actions">
                    <button type="button" class="app-btn app-btn-secondary" (click)="closeUserModal()">Cancelar</button>
                    <button type="submit" class="app-btn app-btn-primary">{{editingUser ? 'Actualizar' : 'Registrar'}}</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Delete Confirmation Modal -->
<div class="modal-backdrop" *ngIf="showDeleteConfirm">
    <div class="app-card modal-card alert-modal">
        <div class="modal-body centered">
            <span class="alert-icon">‚ö†Ô∏è</span>
            <h3>¬øEliminar Usuario?</h3>
            <p>¬øEst√°s seguro de que deseas eliminar permanentemente a <strong class="highlight">{{deletingUser?.name}}</strong>?</p>
            <div class="modal-actions centered">
                <button class="app-btn app-btn-secondary" (click)="closeDeleteConfirmation()">Conservar</button>
                <button class="app-btn app-btn-danger" (click)="deleteUser(deletingUser?.id)">S√≠, Eliminar</button>
            </div>
        </div>
    </div>
</div>
