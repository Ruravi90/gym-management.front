<div class="entity-audit-trail">
  <h3>Historial de Auditoría</h3>
  
  <!-- Loading indicator -->
  <div *ngIf="loading" class="loading">
    <p>Cargando historial de auditoría...</p>
  </div>

  <!-- Error message -->
  <div *ngIf="error" class="alert alert-danger">
    {{ error }}
  </div>

  <!-- Audit trail table -->
  <div *ngIf="!loading && !error" class="audit-trail-table-container card">
    <table class="audit-trail-table">
      <thead>
        <tr>
          <th>Fecha/Hora</th>
          <th>Usuario</th>
          <th>Acción</th>
          <th>Detalles</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let log of auditLogs">
          <td>{{ formatDate(log.timestamp) }}</td>
          <td>{{ log.user_id ? 'Usuario ID: ' + log.user_id : 'Sistema' }}</td>
          <td><span class="badge badge-{{ log.action_type.toLowerCase() }}">{{ log.action_type }}</span></td>
          <td>
            <div *ngIf="log.action_type === 'UPDATE'" class="changes-list">
              <div *ngFor="let change of getChangedFields(log)" class="change-item">
                <strong>{{ change.key }}:</strong> 
                <span class="old-value">{{ getOldValueDisplay(change.key, change.oldValue) }}</span> → 
                <span class="new-value">{{ getNewValueDisplay(change.key, change.newValue) }}</span>
              </div>
            </div>
            <div *ngIf="log.action_type === 'CREATE'" class="creation-details">
              <div *ngFor="let key of getObjectKeys(log.new_values)" class="creation-item">
                <strong>{{ key }}:</strong> {{ getNewValueDisplay(key, log.new_values![key]) }}
              </div>
            </div>
            <div *ngIf="log.action_type === 'DELETE'" class="deletion-details">
              <div *ngFor="let key of getObjectKeys(log.old_values)" class="deletion-item">
                <strong>{{ key }}:</strong> {{ getOldValueDisplay(key, log.old_values![key]) }}
              </div>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Empty state -->
  <div *ngIf="!loading && !error && auditLogs.length === 0" class="empty-state">
    <p>No se encontró historial de auditoría para esta entidad.</p>
  </div>
</div>